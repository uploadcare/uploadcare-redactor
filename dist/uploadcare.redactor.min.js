/**
 * uploadcare-redactor 2.0.0
 * File Uploader by Uploadcare. The plugin for Imperavi Redactor to work with Uploadcare Widget.
 * https://github.com/uploadcare/uploadcare-redactor#readme
 * Date: 2018-05-11
 */

!function(t,a){"use strict";function i(){if(void 0===window.uploadcare){var a="https://ucarecdn.com/libs/widget/"+this.ucOpts.version+"/uploadcare.min.js";t.getScript(a)}}function e(){this.ucOpts=t.extend({},this.redactorOpts.uploadcare),this.ucOpts.crop||(this.ucOpts.crop=""),this.ucOpts.version||(this.ucOpts.version="3.x"),this.redactorOpts.imageTag&&(this.ucOpts.imageTag=this.redactorOpts.imageTag)}function o(){if(void 0!==a)return a.version}function c(){if(void 0!==t.Redactor)return t.Redactor.VERSION}function s(){var t=o()||c();this.ucOpts.integration="Redactor/{redactorVersion}; Uploadcare-Redactor/{pluginVerion}".replace("{redactorVersion}",t).replace("{pluginVerion}","2.0.0")}function n(t){var a=t.cdnUrl;return t.isImage&&!t.cdnUrlModifiers&&(a+="-/preview/"),a}t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a;var r=Object.freeze({broadcast:function(t){this.app.broadcast(t,Array.prototype.slice.call(arguments))},init:function(t){this.app=t,this.toolbar=t.toolbar,this.redactorOpts=this.app.opts,e.call(this),i.call(this),s.call(this)},insertHtml:function(t,a){var i=n(a);a.isImage?t.app.api("module.image.insert",{image:{url:i,alt:a.name,id:a.uuid}}):t.app.api("module.link.insert",{url:i,text:a.name,id:a.uuid})},getSelection:function(){return this.app.selection},start:function(){var t={title:this.ucOpts.buttonLabel||"Uploadcare",api:"plugin.uploadcare.show"},a=this.ucOpts.buttonBefore?this.toolbar.addButtonBefore(this.ucOpts.buttonBefore,"uploadcare",t):this.toolbar.addButton("uploadcare",t);this.ucOpts.buttonIconEnabled&&a.setIcon('<i class="'+(this.ucOpts.buttonIcon?this.ucOpts.buttonIcon:"re-icon-file")+'"></i>')},getVersion:o,addPlugin:function(t){a.add("plugin","uploadcare",t)}});function l(){var t=this.ucOpts.buttonBefore?this.button.addBefore(this.ucOpts.buttonBefore,"uploadcare",this.ucOpts.buttonLabel||"Uploadcare"):this.button.add("uploadcare",this.ucOpts.buttonLabel||"Uploadcare");this.button.addCallback(t,this.uploadcare.show),this.ucOpts.buttonIconEnabled&&this.button.setIcon(t,'<i class="'+(this.ucOpts.buttonIcon?this.ucOpts.buttonIcon:"re-icon-file")+'"></i>')}var u=Object.freeze({broadcast:function(t){this.core.callback(t,Array.prototype.slice.call(arguments))},init:function(){this.redactorOpts=this.opts,e.call(this),i.call(this),s.call(this),l.call(this)},insertHtml:function(t,a){var i=n(a);if(a.isImage){var e=t.ucOpts.imageTag?"<"+t.ucOpts.imageTag+">":"",o=t.ucOpts.imageTag?"</"+t.ucOpts.imageTag+">":"";t.insert.html(e+'<img src="'+i+'" alt="'+a.name+'" data-image="'+a.uuid+'" />'+o,!1)}else t.insert.html('<a href="'+i+'" data-file="'+a.uuid+'">'+a.name+"</a>",!1)},getSelection:function(){return this.selection},start:l,getVersion:c,addPlugin:function(a){t.Redactor.prototype.uploadcare=function(){return a}}});var p=o()?r:u;function d(a){var i=this,e=this.ucOpts.multiple?a.files():[a];p.getSelection.call(this).restore(),t.when.apply(null,e).done(function(){var a=Array.prototype.slice.call(arguments);t.each(a,function(){t.isFunction(i.ucOpts.uploadCompleteCallback)?i.ucOpts.uploadCompleteCallback.call(i,this):p.insertHtml(i,this)}),p.broadcast.call(i,"uploadcareDone",a)})}(o()||c()||(console.error("Uploadcare: Redactor not found."),0))&&p.addPlugin({init:p.init,start:p.start,show:function(){var t=uploadcare.openDialog({},this.ucOpts);p.getSelection.call(this).save(),p.broadcast.call(this,"uploadcareShow",t,this.ucOpts),t.fail(function(){p.getSelection.call(this).restore(),p.broadcast.call(this,"uploadcareCancel")}.bind(this)),t.done(d.bind(this))},done:d})}(window.jQuery,window.Redactor);
