/**
 * uploadcare-redactor 2.0.1
 * File Uploader by Uploadcare. The plugin for Imperavi Redactor to work with Uploadcare Widget.
 * https://github.com/uploadcare/uploadcare-redactor#readme
 * Date: 2019-09-12
 */

!function(t,i){"use strict";function a(){if(void 0===window.uploadcare){var i="https://ucarecdn.com/libs/widget/"+this.ucOpts.version+"/uploadcare.min.js";t.getScript(i)}}function e(){this.ucOpts=t.extend({},this.redactorOpts.uploadcare),this.ucOpts.crop||(this.ucOpts.crop=""),this.ucOpts.version||(this.ucOpts.version="3.x"),this.redactorOpts.imageTag&&(this.ucOpts.imageTag=this.redactorOpts.imageTag)}function o(){if(void 0!==i)return i.version}function c(){if(void 0!==t.Redactor)return t.Redactor.VERSION}function n(){var t=o()||c();this.ucOpts.integration="Redactor/{redactorVersion}; Uploadcare-Redactor/{pluginVerion}".replace("{redactorVersion}",t).replace("{pluginVerion}","2.0.1")}function s(t){var i=t.cdnUrl;return t.isImage&&!t.cdnUrlModifiers&&(i+="-/preview/"),i}t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i;var r=Object.freeze({broadcast:function(t){this.app.broadcast(t,Array.prototype.slice.call(arguments))},init:function(t){this.app=t,this.toolbar=t.toolbar,this.redactorOpts=this.app.opts,e.call(this),a.call(this),n.call(this)},insertHtml:function(t,i){var a=s(i);i.isImage?t.app.api("module.image.insert",{image:{url:a,alt:i.name,id:i.uuid}}):t.app.api("module.link.insert",{url:a,text:i.name,id:i.uuid})},getSelection:function(){return this.app.selection},start:function(){var t={title:this.ucOpts.buttonLabel||"Uploadcare",api:"plugin.uploadcare.show"},i=this.ucOpts.buttonBefore?this.toolbar.addButtonBefore(this.ucOpts.buttonBefore,"uploadcare",t):this.toolbar.addButton("uploadcare",t);this.ucOpts.buttonIconEnabled&&i.setIcon('<i class="'+(this.ucOpts.buttonIcon?this.ucOpts.buttonIcon:"re-icon-file")+'"></i>')},getVersion:o,addPlugin:function(t){i.add("plugin","uploadcare",t)}});function l(){var t=this.ucOpts.buttonBefore?this.button.addBefore(this.ucOpts.buttonBefore,"uploadcare",this.ucOpts.buttonLabel||"Uploadcare"):this.button.add("uploadcare",this.ucOpts.buttonLabel||"Uploadcare");this.button.addCallback(t,this.uploadcare.show),this.ucOpts.buttonIconEnabled&&this.button.setIcon(t,'<i class="'+(this.ucOpts.buttonIcon?this.ucOpts.buttonIcon:"re-icon-file")+'"></i>')}var u=Object.freeze({broadcast:function(t){this.core.callback(t,Array.prototype.slice.call(arguments))},init:function(){this.redactorOpts=this.opts,e.call(this),a.call(this),n.call(this),l.call(this)},insertHtml:function(t,i){var a=s(i);if(i.isImage){var e=t.ucOpts.imageTag?"<"+t.ucOpts.imageTag+">":"",o=t.ucOpts.imageTag?"</"+t.ucOpts.imageTag+">":"";t.insert.html(e+'<img src="'+a+'" alt="'+i.name+'" data-image="'+i.uuid+'" />'+o,!1)}else t.insert.html('<a href="'+a+'" data-file="'+i.uuid+'">'+i.name+"</a>",!1)},getSelection:function(){return this.selection},start:l,getVersion:c,addPlugin:function(i){t.Redactor.prototype.uploadcare=function(){return Object.keys(i).reduce(function(t,a){var e,o=i[a];return t[a]="function"==typeof o?(e=o,function(){e.call(this)}):o,t},{})}}});var p=o()?r:u;function d(i){var a=this,e=this.ucOpts.multiple?i.files():[i];p.getSelection.call(this).restore(),t.when.apply(null,e).done(function(){var i=Array.prototype.slice.call(arguments);t.each(i,function(){t.isFunction(a.ucOpts.uploadCompleteCallback)?a.ucOpts.uploadCompleteCallback.call(a,this):p.insertHtml(a,this)}),p.broadcast.call(a,"uploadcareDone",i)})}(o()||c()||(console.error("Uploadcare: Redactor not found."),0))&&p.addPlugin({init:p.init,start:p.start,show:function(){var t=uploadcare.openDialog({},this.ucOpts);p.getSelection.call(this).save(),p.broadcast.call(this,"uploadcareShow",t,this.ucOpts),t.fail(function(){p.getSelection.call(this).restore(),p.broadcast.call(this,"uploadcareCancel")}.bind(this)),t.done(d.bind(this))},done:d})}(window.jQuery,window.Redactor);
